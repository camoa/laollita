id: recipe_translation
label: 'Import Recipe Translations'
migration_group: recetas
source:
  plugin: url
  data_fetcher_plugin: file
  data_parser_plugin: json
  urls:
    - 'public://import/recipes.json'
  item_selector: /recipes
  fields:
    - name: id
      label: 'Recipe ID'
      selector: id
    - name: langcode
      label: 'Language'
      selector: langcode
    - name: title
      label: 'Title'
      selector: title
    - name: description
      label: 'Description'
      selector: description
    - name: ingredients
      label: 'Ingredients'
      selector: ingredients
    - name: instructions
      label: 'Instructions'
      selector: instructions
  ids:
    id:
      type: string

process:
  # Look up the node ID from the original migration
  nid:
    plugin: migration_lookup
    migration: recipe_import
    source: id

  langcode: langcode
  title: title
  field_summary: description

  field_recipe_instruction/value: instructions
  field_recipe_instruction/format:
    plugin: default_value
    default_value: basic_html

  field_recipe_ingredients:
    plugin: sub_process
    source: ingredients
    process:
      amount: amount
      unit:
        plugin: entity_generate
        entity_type: taxonomy_term
        bundle_key: vid
        bundle: units
        value_key: name
        source: unit
      ingredient: ingredient

destination:
  plugin: 'entity:node'
  default_bundle: recipe
  translations: true

migration_dependencies:
  required:
    - recipe_import
